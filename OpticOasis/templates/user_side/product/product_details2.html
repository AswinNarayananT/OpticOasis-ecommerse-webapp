{% extends 'user_side/user_base.html' %}
{% load static %}
{% block content %}
<style>
    .star-rating {
        direction: rtl;
        font-size: 2rem;
        display: flex;
        justify-content: center;
        cursor: pointer;
    }
    
    .star {
        color: #ccc;
    }
    
    .star.selected,
    .star:hover,
    .star:hover ~ .star {
        color: #f39c12;
    }
    .star-rating-display {
        display: flex;
    }
    
    .star {
        font-size: 2rem;
        color: #ccc; /* Default star color */
    }
    
    .star.filled {
        color: gold; /* Filled star color */
    }
    .icon-red {
        color: red;
        fill: red;
    }
    </style>
<main class="main">
    <div class="page-header breadcrumb-wrap">
        <div class="container">
            <div class="breadcrumb">
                <a href="index.html" rel="nofollow">Home</a>
                <span></span> Fashion
                <span></span> Abstract Print Patchwork Dress
            </div>
        </div>
    </div>
    <section class="mt-50 mb-50">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="product-detail accordion-detail">
                        <div class="row mb-50">
                            <div class="col-md-6 col-sm-12 col-xs-12">
                                <div class="detail-gallery">
                                    <span class="zoom-icon"><i class="fi-rs-search"></i></span>
                                    <!-- MAIN SLIDES -->
                                    <div class="product-image-slider" id="product-image-slider">
                                        {% if variant_images %}
                                            {% for image in variant_images %}
                                            <img src="{{ image.images.url }}" alt="{{ product.product_name }}" class="main-image img-fluid">
                                            {% endfor %}
                                        {% elif product.thumbnail %}
                                            <img src="{{ product.thumbnail.url }}" alt="{{ product.product_name }}" class="main-image img-fluid">
                                        {% else %}
                                            <img src="{% static 'images/No_Image-1024.webp' %}" alt="{{ product.product_name }}" class="main-image img-fluid">
                                        {% endif %}
                                    </div>
                                    <!-- THUMBNAILS -->
                                    <div class="slider-nav-thumbnails pl-15 pr-15" id="thumbnails-slider" style="max-width: 400px; margin: auto;">
                                        {% if variant_images %}
                                            {% for image in variant_images %}
                                            <div class="thumbnail-item"><img src="{{ image.images.url }}" alt="{{ product.product_name }}" class="thumbnail-image img-thumbnail"></div>
                                            {% endfor %}
                                        {% elif product.thumbnail %}
                                            <div class="thumbnail-item"><img src="{{ product.thumbnail.url }}" alt="{{ product.product_name }}" class="thumbnail-image img-thumbnail"></div>
                                        {% else %}
                                            <div class="thumbnail-item"><img src="{% static 'images/No_Image-1024.webp' %}" alt="{{ product.product_name }}" class="thumbnail-image img-thumbnail"></div>
                                        {% endif %}
                                    </div>
                                </div>
                                <!-- End Gallery -->
                            </div>
                            <div class="col-md-6 col-sm-12 col-xs-12">
                                <div class="detail-info">
                                    <h2 class="title-detail">{{ product.product_name }}</h2>
                                    <div class="product-detail-rating">
                                        <div class="pro-details-brand">
                                            <span> Brands: <a href="shop-grid-right.html">{{ product.product_brand}}</a></span>
                                        </div>
                                        <div class="product-rate-cover text-end">
                                            <div class="product-rate d-inline-block">
                                                <div class="product-rating" style="width:90%"></div>
                                            </div>
                                            <span class="font-small ml-5 text-muted"> (25 reviews)</span>
                                        </div>
                                    </div>
                                    <div class="clearfix product-price-cover">
                                        <div class="product-price primary-color float-left">
                                            <ins><span class="text-brand">₹{{ product.offer_price }}</span></ins>
                                            <ins><span class="old-price font-md ml-15"> ₹{{ product.price }}</span></ins>
                                            <span class="save-price font-md color3 ml-15">{{ product.percentage_discount }}% Off</span>
                                        </div>
                                    </div>
                                    <div class="bt-1 border-color-1 mt-15 mb-15"></div>
                                    <div class="short-desc mb-30">
                                        <p>{{ product.product_description }}</p>
                                    </div>
                                    <div class="product_sort_info font-xs mb-30">
                                        <ul>
                                            <li class="mb-10"><i class="fi-rs-crown mr-5"></i> 1 Year AL Jazeera Brand Warranty</li>
                                            <li class="mb-10"><i class="fi-rs-refresh mr-5"></i> 30 Day Return Policy</li>
                                            <li><i class="fi-rs-credit-card mr-5"></i> Cash on Delivery available</li>
                                        </ul>
                                    </div>
                                    <div class="attr-detail attr-color mb-15">
                                        <strong class="mr-10">Color</strong>
                                        <ul class="list-filter color-filter">
                                            {% for variant in variants %}
                                            <li class="list-inline-item {% if selected_variant.id == variant.id %}active{% endif %}">
                                                <a href="#" class="color-select {% if selected_variant.id == variant.id %}selected{% endif %}" data-variant-id="{{ variant.id }}" data-image-urls="{% for image in variant.product_variant_images_set.all %}{{ image.images.url }}{% if not forloop.last %},{% endif %}{% endfor %}">
                                                    <span class="d-inline-block rounded-circle border border-dark position-relative" style="background-color: {{ variant.colour_code }}; width: 25px; height: 25px;">
                                                        {% if variant.id == selected_variant.id %}
                                                        <i class="fi-rs-check position-absolute top-0 start-100 translate-middle text-white" style="font-size: 12px; right: 0; top: 0;"></i>
                                                        {% endif %}
                                                    </span>
                                                </a>
                                            </li>
                                            {% endfor %}
                                        </ul>
                                       
                                    </div>
                                    <div class="attr-detail attr-size">
                                        <strong class="mr-10">Size</strong>
                                        <ul class="list-filter size-filter font-small" id="size-list">
                                            {% if unique_sizes %}
                                                {% for size in unique_sizes %}
                                                <li>
                                                    <a href="#" class="size-selector {% if size.size == selected_size %}active{% endif %}" data-size="{{ size.size }}">
                                                        {{ size.size }}: <span class="stock-status">{% if size.variant_stock > 0 %}{{ size.variant_stock }} in stock{% else %}Out of Stock{% endif %}</span>
                                                    </a>
                                                </li>
                                                {% endfor %}
                                            {% else %}
                                            <li>
                                                <a class="size-selector">
                                                    {{ selected_variant.size }}: <span class="stock-status">{% if selected_variant.variant_stock > 0 %}{{ selected_variant.variant_stock }} in stock{% else %}Out of Stock{% endif %}</span>
                                                </a>
                                            </li>
                                            {% endif %}
                                        </ul>
                                        
                                        
                                       
                                    </div>
                                    
                                    <div class="bt-1 border-color-1 mt-30 mb-30"></div>
                                    <div class="detail-extralink">
                                        <div class="detail-qty border radius">
                                            <a href="#" class="qty-down"><i class="fi-rs-angle-small-down"></i></a>
                                            <span class="qty-val">1</span>
                                            <a href="#" class="qty-up"><i class="fi-rs-angle-small-up"></i></a>
                                        </div>
                                        <div class="product-extra-link2">
                                            {% if user.is_authenticated %}
                                                <!-- Add to Cart Button -->
                                                <button type="button" class="button button-add-to-cart">Add to Cart</button>

                                                <!-- Go to Cart Button (Initially hidden) -->
                                                <button id="go-to-cart" type="button" class="button button-go-to-cart" style="display:none;">Go to Cart</button>

                                                 <!-- Wishlist Button -->
                                                 <!-- Wishlist Button -->
                                                <a href="#" class="action-btn hover-up wishlist-toggle" data-url="{% url 'userpanel:toggle_wishlist' %}">
                                                    <i class="fi-rs-heart" id="wishlistIcon"></i>
                                                </a>
                                            {% else %}
                                                <button type="button" class="button button-add-to-cart" id="login-to-add">Add to Cart</button>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <ul class="product-meta font-xs color-grey mt-50">
                                        <li class="mb-5">SKU: <a href="#">FWM15VKT</a></li>
                                        <li class="mb-5">Tags: <a href="#" rel="tag">Cloth</a>, <a href="#" rel="tag">Women</a>, <a href="#" rel="tag">Dress</a> </li>
                                        <li>Availability:<span class="in-stock text-success ml-5">8 Items In Stock</span></li>
                                    </ul>
                                </div>
                                <!-- Detail Info -->
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-lg-10 m-auto entry-main-content">
                                <h2 class="section-title style-1 mb-30">Description</h2>
                                <div class="description mb-50">
                                    <p>{{ products.product_description }}</p>
                                    <ul class="product-more-infor mt-30">
                                        <li><span>Type Of Packing</span> Custom-designed, fashion-forward packaging to complement the style and sophistication of your purchase.</li>
                                        <li><span>Color Options</span> Available in elegant Green, chic Pink, stylish Powder Blue, and classic Purple.</li>
                                        <li><span>Quantity Per Case</span>100 ml bottles, ideal for personal or gift use.l</li>
                                        <li><span>Ethyl Alcohol Content: </span>70% - ensuring high quality and durability.</li>
                                        <li><span>Carton Details</span>Each carton contains multiple pieces, ensuring secure and organized shipping.</li>
                                    </ul>
                                    <hr class="wp-block-separator is-style-dots">
                                    
                                    <h4 class="mt-30">Packaging & Delivery</h4>
                                    <p>We take pride in ensuring that your purchase arrives in perfect condition. Each item is meticulously packaged using premium materials to protect it during transit. Our products are carefully wrapped and secured in a sturdy box, complete with branded tissue paper and a signature seal for an elegant touch, making the unboxing experience as delightful as the product itself.

                                        Our fast and reliable delivery services ensure your order reaches you as quickly as possible. We partner with efficient and dependable shipping providers and offer real-time tracking information so you can monitor your package's journey from our warehouse to your doorstep. Depending on your location, various shipping options are available to suit your needs, including expedited delivery for those times when you just can’t wait. Enjoy hassle-free delivery and exceptional service with every order.
                                    </p>
                                </div>
                                <div class="social-icons single-share">
                                    <ul class="text-grey-5 d-inline-block">
                                        <li><strong class="mr-10">Share this:</strong></li>
                                        <li class="social-facebook"><a href="#"><img src="assets/imgs/theme/icons/icon-facebook.svg" alt=""></a></li>
                                        <li class="social-twitter"> <a href="#"><img src="assets/imgs/theme/icons/icon-twitter.svg" alt=""></a></li>
                                        <li class="social-instagram"><a href="#"><img src="assets/imgs/theme/icons/icon-instagram.svg" alt=""></a></li>
                                        <li class="social-linkedin"><a href="#"><img src="assets/imgs/theme/icons/icon-pinterest.svg" alt=""></a></li>
                                    </ul>
                                </div>
                                <h3 class="section-title style-1 mb-30 mt-30">Reviews (3)</h3>
                                <!--Comments-->
                                <div class="comments-area style-2">
                                    <div class="row">
                                        <div class="col-lg-8 d-flex">
                                            <div >
                                                <h4 class="mb-30">Customer questions & answers</h4>
                                                {% for review in reviews %}
                                                {% if review %}
                                                <div class="comment-list">
                                                    <div class="single-comment justify-content-between d-flex">
                                                        <div class="user justify-content-between d-flex">
                                                            <div class="thumb text-center">
                                                                <img src="{% static 'user_side/assets/imgs/page/avatar-6.jpg' %}" alt="">
                                                                <h6><a href="#">{{ review.user }}</a></h6>
                                                                <p class="font-xxs">Since 2012</p>
                                                            </div>
                                                            <div class="desc">
                                                                
                                                                    <div class="star-rating-display" data-rating="{{ review.rating }}">
                                                                        <span class="star">&#9733;</span>
                                                                        <span class="star">&#9733;</span>
                                                                        <span class="star">&#9733;</span>
                                                                        <span class="star">&#9733;</span>
                                                                        <span class="star">&#9733;</span>
                                                                    </div>
                                                                
                                                                <p>{{ review.comment }}</p>
                                                                <div class="d-flex justify-content-between">
                                                                    <div class="d-flex align-items-center">
                                                                        <p class="font-xs mr-30">{{ review.created_at }} </p>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div>
                                                                <div style="margin-left:100px; width:50px;" >
                                                                    <form action="" method="post">
                                                                        {% csrf_token %}
                                                                        <button class="btn btn-danger " type="submit">Delete</button>
                                                                    </form>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    {% endif %}
                                                    {% endfor %}
                                                </div>
                                                    <div>
                                                        <div class="col-lg-4">
                                                            <h4 class="mb-30">Customer reviews</h4>
                                                            <div class="d-flex mb-30">
                                                                <div class="star-rating-display" data-rating="{{ products.get_average_rating }}">
                                                                    <span class="star">&#9733;</span>
                                                                    <span class="star">&#9733;</span>
                                                                    <span class="star">&#9733;</span>
                                                                    <span class="star">&#9733;</span>
                                                                    <span class="star">&#9733;</span>
                                                                </div>
                                                            
                                                            <h6></h6>
                                                        </div>
                                                        <div>
                                                            <div class="progress">
                                                                <span>5 star</span>
                                                                <div class="progress-bar" role="progressbar" style="width: 50%;" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100">50%</div>
                                                            </div>
                                                            <div class="progress">
                                                                <span>4 star</span>
                                                                <div class="progress-bar" role="progressbar" style="width: 25%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">25%</div>
                                                            </div>
                                                            <div class="progress">
                                                                <span>3 star</span>
                                                                <div class="progress-bar" role="progressbar" style="width: 45%;" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100">45%</div>
                                                            </div>
                                                            <div class="progress">
                                                                <span>2 star</span>
                                                                <div class="progress-bar" role="progressbar" style="width: 65%;" aria-valuenow="65" aria-valuemin="0" aria-valuemax="100">65%</div>
                                                            </div>
                                                            <div class="progress mb-30">
                                                                <span>1 star</span>
                                                                <div class="progress-bar" role="progressbar" style="width: 85%;" aria-valuenow="85" aria-valuemin="0" aria-valuemax="100">85%</div>
                                                            </div>
                                                            <a href="#" class="font-xs text-muted">How are ratings calculated?</a>
                                                        </div>
                                            </div>
                                        </div>
                                        
                                    </div>
                                </div>
                                <!--comment form-->
                                <div class="comment-form">
                                    <h4 class="mb-15">Add a review</h4>
                                    <div class="row">
                                        <div class="col-lg-8 col-md-12">
                                            <form method="post" class="form-contact comment_form" action="{% url 'product:add-review' product.id %}" id="commentForm">
                                                {% csrf_token %}
                                                <div class="row">
                                                    <div class="col-12">
                                                        <div class="form-group">
                                                            <textarea class="form-control w-100" name="comment" id="comment" cols="30" rows="9" placeholder="Write Comment" required></textarea>
                                                        </div>
                                                    </div>
                                                    <div>
                                                        <div class="star-rating" id="star-rating">
                                                            <span class="star" data-value="1">&#9733;</span>
                                                            <span class="star" data-value="2">&#9733;</span>
                                                            <span class="star" data-value="3">&#9733;</span>
                                                            <span class="star" data-value="4">&#9733;</span>
                                                            <span class="star" data-value="5">&#9733;</span>
                                                        </div>
                                                        <input type="hidden" id="rating" name="rating" value="0" required>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <button type="submit" class="button button-contactForm">Submit Review</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                        </div>
                        <div class="row mt-60">
                            <div class="col-12">
                                <h3 class="section-title style-1 mb-30">Related products</h3>
                            </div>
                            <div class="col-12">
                                <div class="row related-products">
                                    <div class="col-lg-3 col-md-4 col-12 col-sm-6">
                                        <div class="product-cart-wrap small hover-up">
                                            <div class="product-img-action-wrap">
                                                <div class="product-img product-img-zoom">
                                                    <a href="shop-product-right.html" tabindex="0">
                                                        <img class="default-img" src="assets/imgs/shop/product-2-1.jpg" alt="">
                                                        <img class="hover-img" src="assets/imgs/shop/product-2-2.jpg" alt="">
                                                    </a>
                                                </div>
                                                <div class="product-action-1">
                                                    <a aria-label="Quick view" class="action-btn small hover-up" data-bs-toggle="modal" data-bs-target="#quickViewModal
"><i class="fi-rs-search"></i></a>
                                                    <a aria-label="Add To Wishlist" class="action-btn small hover-up" href="shop-wishlist.html" tabindex="0"><i class="fi-rs-heart"></i></a>
                                                    <a aria-label="Compare" class="action-btn small hover-up" href="shop-compare.html" tabindex="0"><i class="fi-rs-shuffle"></i></a>
                                                </div>
                                                <div class="product-badges product-badges-position product-badges-mrg">
                                                    <span class="hot">Hot</span>
                                                </div>
                                            </div>
                                            <div class="product-content-wrap">
                                                <h2><a href="shop-product-right.html" tabindex="0">Ulstra Bass Headphone</a></h2>
                                                <div class="rating-result" title="90%">
                                                    <span>
                                                    </span>
                                                </div>
                                                <div class="product-price">
                                                    <span>$238.85 </span>
                                                    <span class="old-price">$245.8</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-md-4 col-12 col-sm-6">
                                        <div class="product-cart-wrap small hover-up">
                                            <div class="product-img-action-wrap">
                                                <div class="product-img product-img-zoom">
                                                    <a href="shop-product-right.html" tabindex="0">
                                                        <img class="default-img" src="assets/imgs/shop/product-3-1.jpg" alt="">
                                                        <img class="hover-img" src="assets/imgs/shop/product-4-2.jpg" alt="">
                                                    </a>
                                                </div>
                                                <div class="product-action-1">
                                                    <a aria-label="Quick view" class="action-btn small hover-up" data-bs-toggle="modal" data-bs-target="#quickViewModal
"><i class="fi-rs-search"></i></a>
                                                    <a aria-label="Add To Wishlist" class="action-btn small hover-up" href="shop-wishlist.html" tabindex="0"><i class="fi-rs-heart"></i></a>
                                                    <a aria-label="Compare" class="action-btn small hover-up" href="shop-compare.html" tabindex="0"><i class="fi-rs-shuffle"></i></a>
                                                </div>
                                                <div class="product-badges product-badges-position product-badges-mrg">
                                                    <span class="sale">-12%</span>
                                                </div>
                                            </div>
                                            <div class="product-content-wrap">
                                                <h2><a href="shop-product-right.html" tabindex="0">Smart Bluetooth Speaker</a></h2>
                                                <div class="rating-result" title="90%">
                                                    <span>
                                                    </span>
                                                </div>
                                                <div class="product-price">
                                                    <span>$138.85 </span>
                                                    <span class="old-price">$145.8</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-md-4 col-12 col-sm-6">
                                        <div class="product-cart-wrap small hover-up">
                                            <div class="product-img-action-wrap">
                                                <div class="product-img product-img-zoom">
                                                    <a href="shop-product-right.html" tabindex="0">
                                                        <img class="default-img" src="assets/imgs/shop/product-4-1.jpg" alt="">
                                                        <img class="hover-img" src="assets/imgs/shop/product-4-2.jpg" alt="">
                                                    </a>
                                                </div>
                                                <div class="product-action-1">
                                                    <a aria-label="Quick view" class="action-btn small hover-up" data-bs-toggle="modal" data-bs-target="#quickViewModal
"><i class="fi-rs-search"></i></a>
                                                    <a aria-label="Add To Wishlist" class="action-btn small hover-up" href="shop-wishlist.html" tabindex="0"><i class="fi-rs-heart"></i></a>
                                                    <a aria-label="Compare" class="action-btn small hover-up" href="shop-compare.html" tabindex="0"><i class="fi-rs-shuffle"></i></a>
                                                </div>
                                                <div class="product-badges product-badges-position product-badges-mrg">
                                                    <span class="new">New</span>
                                                </div>
                                            </div>
                                            <div class="product-content-wrap">
                                                <h2><a href="shop-product-right.html" tabindex="0">HomeSpeak 12UEA Goole</a></h2>
                                                <div class="rating-result" title="90%">
                                                    <span>
                                                    </span>
                                                </div>
                                                <div class="product-price">
                                                    <span>$738.85 </span>
                                                    <span class="old-price">$1245.8</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-md-4 col-12 col-sm-6">
                                        <div class="product-cart-wrap small hover-up mb-0">
                                            <div class="product-img-action-wrap">
                                                <div class="product-img product-img-zoom">
                                                    <a href="shop-product-right.html" tabindex="0">
                                                        <img class="default-img" src="assets/imgs/shop/product-5-1.jpg" alt="">
                                                        <img class="hover-img" src="assets/imgs/shop/product-3-2.jpg" alt="">
                                                    </a>
                                                </div>
                                                <div class="product-action-1">
                                                    <a aria-label="Quick view" class="action-btn small hover-up" data-bs-toggle="modal" data-bs-target="#quickViewModal
"><i class="fi-rs-search"></i></a>
                                                    <a aria-label="Add To Wishlist" class="action-btn small hover-up" href="shop-wishlist.html" tabindex="0"><i class="fi-rs-heart"></i></a>
                                                    <a aria-label="Compare" class="action-btn small hover-up" href="shop-compare.html" tabindex="0"><i class="fi-rs-shuffle"></i></a>
                                                </div>
                                                <div class="product-badges product-badges-position product-badges-mrg">
                                                    <span class="hot">Hot</span>
                                                </div>
                                            </div>
                                            <div class="product-content-wrap">
                                                <h2><a href="shop-product-right.html" tabindex="0">Dadua Camera 4K 2022EF</a></h2>
                                                <div class="rating-result" title="90%">
                                                    <span>
                                                    </span>
                                                </div>
                                                <div class="product-price">
                                                    <span>$89.8 </span>
                                                    <span class="old-price">$98.8</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="banner-img banner-big wow fadeIn f-none animated mt-50">
                            <img class="border-radius-10" src="assets/imgs/banner/banner-4.png" alt="">
                            <div class="banner-text">
                                <h4 class="mb-15 mt-40">Repair Services</h4>
                                <h2 class="fw-600 mb-20">We're an Apple <br>Authorised Service Provider</h2>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        // Function to check if the item is already in the cart
        function updateButtonStatus() {
            var selectedColor = $('.color-select.selected').data('variant-id');
            
            if (!selectedColor) {
                return;
            }
    
            $.ajax({
                url: "{% url 'cart:button' %}", // Adjust this URL to your actual endpoint
                method: "GET",
                data: {
                    'variant_id': selectedColor
                },
                success: function(response) {
                    if (response.is_in_cart) {
                        $('.button-add-to-cart').hide();
                        $('.button-go-to-cart').show();
                    } else {
                        $('.button-add-to-cart').show();
                        $('.button-go-to-cart').hide();
                    }
                },
                error: function(xhr, status, error) {
                    console.error(xhr.responseText);
                }
            });
        }
    
        $.ajaxSetup({
            beforeSend: function(xhr, settings) {
                if (!/^(GET|HEAD|OPTIONS|TRACE)$/.test(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", "{{ csrf_token }}");
                }
            }
        });
    
        $('.qty-down').on('click', function(e) {
            e.preventDefault();
            var qtyVal = $(this).siblings('.qty-val');
            var qty = parseInt(qtyVal.text());
            if (qty > 1) {
                qtyVal.text(qty - 1);
            }
        });
        
        $('.qty-up').on('click', function(e) {
            e.preventDefault();
            var qtyVal = $(this).siblings('.qty-val');
            var qty = parseInt(qtyVal.text());
            if (qty < 5) {
                qtyVal.text(qty + 1);
            }
        });
    
        $('.color-select').on('click', function(e) {
            e.preventDefault();
            $('.color-select').removeClass('selected'); // Remove selected class from all
            $(this).addClass('selected'); // Add selected class to the clicked one
    
            var imageUrls = $(this).data('image-urls').split(',');
            var variantId = $(this).data('variant-id');
            
            // Update main image slider
            $('#product-image-slider .main-image').each(function(index, img) {
                var adjustedIndex = index - 1;
                if (adjustedIndex >= 0 && adjustedIndex < imageUrls.length && imageUrls[adjustedIndex]) {
                    $(img).attr('src', imageUrls[adjustedIndex]);
                }
            });
    
            // Update thumbnails
            $('#thumbnails-slider .thumbnail-item img').each(function(index, img) {
                var adjustedIndex = index;
                if (adjustedIndex >= 0 && adjustedIndex < imageUrls.length && imageUrls[adjustedIndex]) {
                    $(img).attr('src', imageUrls[adjustedIndex]);
                } else {
                    $(img).attr('src', ''); // Clear if no image is available
                }
            });
    
            // Fetch and update sizes for the selected variant
            $.ajax({
                url: "{% url 'product:get-variant-sizes' %}", // Adjust this URL to your actual endpoint
                method: 'GET',
                data: {
                    variant_id: variantId
                },
                success: function(response) {
                    var sizeList = $('#size-list');
                    sizeList.empty();
                    response.sizes.forEach(function(item) {
                        var size = item.size;
                        var stock = item.stock;
                        var stockText = stock > 0 ? stock + ' in stock' : 'Out of Stock';
                        sizeList.append('<li><a href="#" class="size-selector" data-size="' + size + '">' + size + ': <span class="stock-status">' + stockText + '</span></a></li>');
                    });
                },
                error: function() {
                    console.error('Failed to fetch sizes for the selected variant.');
                }
            });
            // Update button status based on the selected variant
            updateButtonStatus();
        });
    
        $('.button-add-to-cart').on('click', function(e) {
            e.preventDefault();
            var selectedColor = $('.color-select.selected').data('variant-id');
            var quantity = $(this).closest('.detail-extralink').find('.qty-val').text();
    
            if (!selectedColor) {
                alert('Please select a color variant.');
                return;
            }
    
            $.ajax({
                url: "{% url 'cart:add-to-cart' %}",
                method: "POST",
                data: {
                    'variant_id': selectedColor,
                    'quantity': quantity,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function(response) {
                    if (response.status == 'success') {
                        alert('Item added to cart');
                        // Update button status after adding item to cart
                        updateButtonStatus();
                    } else {
                        alert('Error adding item to cart');
                    }
                },
                error: function(xhr, status, error) {
                    console.error(xhr.responseText);
                    alert('An error occurred. Please try again.');
                }
            });
        });
    
        $('#login-to-add').on('click', function() {
            window.location.href = "{% url 'login' %}";
        });

        $('#go-to-cart').on('click', function() {
            window.location.href = "{% url 'cart:cart-view' %}";
        });
    
        // Initial call to set button status when the page loads
        updateButtonStatus();
    });
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const wishlistToggle = document.querySelector('.wishlist-toggle');
        const wishlistIcon = wishlistToggle.querySelector('i');

        function showNotification(icon, title) {
            Swal.fire({
                toast: true,
                position: 'top-right',
                icon: icon,
                title: title,
                showConfirmButton: false,
                timer: 3000
            });
        }

        wishlistToggle.addEventListener('click', function(e) {
            e.preventDefault();
            const selectedVariant = document.querySelector('.color-select.selected');
            const wishlistIcon = document.getElementById('wishlistIcon');
            const variantId = selectedVariant ? selectedVariant.dataset.variantId : null;
            const url = this.dataset.url;

            if (!variantId) {
                console.error('No variant selected');
                showNotification('error', 'Please select a variant');
                return;
            }

            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify({variant_id: variantId})
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                if (data.status === 'added') {
                    wishlistIcon.classList.add('icon-red');
                    showNotification('success', 'Product added to wishlist');
                } else if (data.status === 'removed') {
                    wishlistIcon.classList.remove('icon-red');
                    showNotification('info', 'Product removed from wishlist');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('error', 'An error occurred');
            });
        });

        // Update wishlist icon when color is selected
        document.querySelectorAll('.color-select').forEach(colorSelect => {
            colorSelect.addEventListener('click', function() {
                const variantId = this.dataset.variantId;
                updateWishlistIcon(variantId);
            });
        });

        function updateWishlistIcon(variantId) {
            if (userWishlist.includes(parseInt(variantId))) {
                wishlistIcon.classList.add('text-danger');
            } else {
                wishlistIcon.classList.remove('text-danger');
            }
        }

        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        // Initialize wishlist icon for the initially selected variant
        const initiallySelectedVariant = document.querySelector('.color-select.selected');
        if (initiallySelectedVariant) {
            updateWishlistIcon(initiallySelectedVariant.dataset.variantId);
        }

        // Display any Django messages
        {% if messages %}
            const messages = [
                {% for message in messages %}
                    {
                        level: "{{ message.tags }}",
                        text: "{{ message }}"
                    },
                {% endfor %}
            ];
            messages.forEach(message => {
                Swal.fire({
                    toast: true,
                    position: 'top-right',
                    icon: message.level === 'success' ? 'success' : 'error',
                    title: message.text,
                    showConfirmButton: false,
                    timer: 3000
                });
            });
        {% endif %}
    });
</script>
<script>
    const userWishlist = {{ user_wishlist|safe }};
</script>

{% endblock %}